import json
import numpy as np
import pandas as pd
import requests


apiURL = "http://www.opensecrets.org/api/?method=getLegislators&id=PA&apikey=__APIKEY__&output=json"
req = requests.get(apiURL)
errors = 0


if int(req.status_code)==200:
    apiDict = json.loads(req.text) #json.loads
    candidates = 0
    runningTotal = 0
    avg = 0
    male = 0
    female = 0
    totalTenure = 0
    moneySpent = 0
    firstLevel = apiDict['response']['legislator']


    for i in firstLevel:
        att = i['@attributes']
        cid = att['cid']

        if att['gender'] == 'M':
            male += 1
        elif att['gender'] == 'F':
            female += 1

        getSummary = "http://www.opensecrets.org/api/?method=candSummary&cid=" + str(cid) + "&cycle=2018&apikey=__APIKEY__&output=json"
        sumGet = requests.get(getSummary)
        if int(sumGet.status_code)==200: #checks for any errors in recreating the url
            sumDict = json.loads(sumGet.text)
            sum = sumDict['response']['summary']['@attributes']
            candidates += 1
            tenure = 2019 - int(sum['first_elected'])
            totalTenure = totalTenure + tenure
            moneySpent = moneySpent + float(sum['spent'])
            runningTotal = runningTotal + float(sum['cash_on_hand'])
            print(sum['cand_name'] + ": $" + sum['cash_on_hand'])


        else:
            errors += 1

    avg = int(runningTotal / candidates)
    print ("*" * 25)
    print ("$" + str(avg) + " per candidate on hand")
    print ("*" * 25)
    ratio = int(male / female)
    print ("The ratio of male to female candidates is " + str(ratio) + ":1" )
    print ("*" * 25)
    avgTenure = int(totalTenure / candidates)
    print ("The average tenure is " + str(avgTenure) + " years")
    print ("*" * 25)
    moneyINT = int(moneySpent)
    print ("A total of $" + str(moneyINT) + " has been spent by winning campaigns in PA during the 2018 cycle.")
    print ("*" * 25)
    if errors < 1 or errors > 1:
        print ("with " + str(errors) + " errors")
    else:
        print ("With " + str(errors) + " error")
